---
title: "[Cloud] VPC의 이해"
date: 2024-10-21 00:00:00 +0900
categories: [클라우드 인프라 구축 프로젝트]
tags: [cloud, vpc, network]
render_with_liquid: false
---

## Amazon **VPC 이해**

---

- **학습 목표
-** Amazon VPC에 대해 이해합니다.
- Amazon VPC내의 네트워크 구조 중 프라이빗 서브넷과 퍼블릭 서브넷의 차이를 이해합니다.
- IGW, NAT GW의 의미와 필요성을 이해합니다. 
- AWS 클라우드에서 기본으로 제공하는 Default VPC를 이해합니다.

---

### Amazon VPC

- AWS 클라우드의 **가상 네트워크 서비스**
- VPC는 **완벽하게 격리된 독립된 가상 네트워크**로 리전마다 독립적으로 하나 또는 여러 개 운영 가능. 
예: 서울 리전에 VPC를 생성하면 했다면 생성한 VPC는 서울 리전에만 있으며, 다른 리전에는 없습니다
- 가상의 네트워크(VPC)에 필요한 IP주소에 맞게 네트워크 주소와 CIDR를 설정
예: 10.0.0.0/16(65536) 을 네트워크 주소로 사용하는 VPC는 총 65536개의 IP 주소를 사용할 수 있음(A: 10.0.0.0/16     B:10.1.0.0/16)
인터넷에서 IPv4 서브넷 CIDR 블록을 계산하고 생성하는 데 도움이 되는 도구가 있음: [CIDR  계산기](https://www.ipaddressguide.com/cidr)
    
    ![Untitled](/assets/img/Cloud/vpc/Untitled.png)
    

- VPC와 가용영역
    
    ![image.png](/assets/img/Cloud/vpc/image.png)
    
    - VPC:
        - 다른 VPC와 **논리적으로** **격리**됨
        - 사용자의 AWS 계정 **전용**
        - 단일 **AWS 리전**에 속하며 여러 가용 영역에 걸쳐 구현될 수 있음
        

### 서브넷

- **서브넷(Subnet)은** VPC에 할당된 네트워크를 **서브 네팅** 해서 네트워크를 나눈 영역
    
    10.0.0.0/16 (65535)
    
    10.0.0.0/24 = 256
    10.0.0.0/20 = 4094
    
    ![Untitled](/assets/img/Cloud/vpc/Untitled%201.png)
    
- **퍼블릭 서브넷**
    - **외부와 직접 통신**이 가능한 네트워크 영역
    - 외부 접속이 필요한 서버를 만들 때는 퍼블릭 서브넷에 생성
- **프라이빗 서브넷**
    - **외부와 직접 통신이 불가능한 네트워크** 영역
    - 인터넷에 직접 연결할 필요 없고, 높은 보안성을 요구하는 서버는 프라이빗 서브넷에 생성

### **인터넷 게이트웨이**

- VPC내의 와 인터넷 간의 통신을 지원합니다.
- 인터넷 게이트웨이를 사용하면 퍼블릭 서브넷에 생성된 인스턴스(서버)들이 인터넷에 연결할 수 있음
    
    ![Untitled](/assets/img/Cloud/vpc/Untitled%202.png)
    

### 라우팅 테이블

- 서브넷 아웃바운드 트래픽 허용
- 라우팅 테이블에 인터넷게이트에 대한 경로가 있어야 서브넷의 서버들은 외부 통신 허용
- 인터넷 게이트웨이 없이는 VPC 내의 모든 인스턴스가 외부 인터넷 통신을 할 수 없음
    
    [https://lh7-us.googleusercontent.com/oC5w6hdEhQhRGEc5JGpeNfISO37xgtVkXYTza9YxnHok-6p1h6BrXR9QEzwAAl-bOIhI_i4ixsK-UbqfvTNdzaViBKU6ecKko4-189_P-aLcNP2ZmhaC_ftDdVjHs72O21mPnLJ8-DMzt5Zr6aJplA](https://lh7-us.googleusercontent.com/oC5w6hdEhQhRGEc5JGpeNfISO37xgtVkXYTza9YxnHok-6p1h6BrXR9QEzwAAl-bOIhI_i4ixsK-UbqfvTNdzaViBKU6ecKko4-189_P-aLcNP2ZmhaC_ftDdVjHs72O21mPnLJ8-DMzt5Zr6aJplA)
    

### N**AT 게이트웨이**

- NAT게이트웨이는  NAT(Network Address Translation) 서비스입니다.
- 인스턴스의 소스 IP 주소를 NAT 게이트웨이의 IP 주소(퍼블릭IP 주소)로 바꿉니다
- NAT 인터넷 게이트웨이를 사용하면 프라이빗 서브넷에 생성된 서버들이 인터넷에 연결할 수 있음
    
    ![Untitled](/assets/img/Cloud/vpc/Untitled%203.png)
    
- NAT게이트웨이에서 라우팅 테이블을 구성해서 프라이빗 서브넷의 인스턴스가  NAT GW를 통해 외부 통신 가능하도록 구성해야함.
- 프라이빗 서브넷의 인스턴스들은 NAT 게이트웨이에 연결되어 자신들의 프라이빗 IP 주소를 NAT  게이트웨이의 퍼블릭 IP 주소로 바꿔서 외부 인터넷과 연결
    - 사설 IP 주소를 가진 웹서버가 인터넷 통신을 수행하는 과정
        
        [https://lh7-us.googleusercontent.com/qIp7weKvBGfGeLx9mE31gtJ_CiNDN4acZGxQ3zx7rfJsz26wBabltNZCNcMErDnF0Sly9xQPtti8WTtLKz28ApuehmiR0-DpDddIDHiPKSMEeQlx7V9Pfqn3l2ikIDztKpqn1vzjiUlzr2tGcro8bw](https://lh7-us.googleusercontent.com/qIp7weKvBGfGeLx9mE31gtJ_CiNDN4acZGxQ3zx7rfJsz26wBabltNZCNcMErDnF0Sly9xQPtti8WTtLKz28ApuehmiR0-DpDddIDHiPKSMEeQlx7V9Pfqn3l2ikIDztKpqn1vzjiUlzr2tGcro8bw)
        
        웹서버는 프라이빗 서브넷의 10.0.20.40인 사설 IP주소를 가지고 있어 외부 인터넷의 다른 디바이스와 연결할 수 없는 상태
        
        사설 IP주소를 가진 웹서버가 NAT 게이트웨이를 통과해 공인 IP  주소로 변환된 후 인터넷게이트웨이를 통해 외부 인터넷 디바이스와 연결
        
        - [NAT 게이트웨이 요금](https://aws.amazon.com/ko/vpc/pricing/) : **프리티어 서비스로 적용 안됨**. 2024년 10월 서울 리전의 경우 **시간당 $0.059**가 부과됩니다.
            
            ![Untitled](/assets/img/Cloud/vpc/Untitled%204.png)
            

### **탄력적 IP**

- 탄력적 IP 주소는 **인터넷에서 연결 가능한 퍼블릭 IPv4 주소**
- 퍼블릭 서브넷에 인스턴스를 생성해도 퍼블릭 IPv4 주소가 없으면 외부 접속이 불가능함.
- 탄력적 IP 주소를 인스턴스에 연결하여 인터넷 통신을 활성화할 수 있음
- 탄력적 IP 주소는 NAT  게이트웨이에 할당되어야 프라이빗 서브넷의 인스턴스들이 NAT GW의 퍼블릭 IP주소로 변환되어 외부 통신할 수 있음
    
    <aside>
    📌 NAT 게이트웨이의 [탄력적 IP 할당]이 필수 선택 사항은 아니지만, 프라이빗 서브넷의 인스턴스들은 외부 서비스와 연결될 때 NAT 게이트웨이의 고정 IP를 기준으로 접근 제어를 하기 때문에 현업에서는 NAT 게이트웨이에 [탄력적 IP 할당]을 기본처럼 사용합니다.
    
    </aside>
    
- [탄력적 IP 요금](https://aws.amazon.com/ko/ec2/pricing/on-demand/#Elastic_IP_Addresses) : 프리티어 서비스로 지원 안됨. 23년 12월 기준 시간당 0.005 USD를 과금
    
    ![Untitled](/assets/img/Cloud/vpc/Untitled%205.png)
    

### **Default VPC vs 사용자 정의 VPC**

- **Default VPC**
    - AWS  클라우드를 사용하면 default VPC 가 생성되어 쉽게 서버를 운영할 수 있도록 지원합니다.
        - 172.31.0.0/16
        - 최대 65,536개의 프라이빗 IPv4 주소를 제공
        - 네트워크 운영을 위한 퍼블릭 서브넷, 인터넷 게이트웨어, 라우팅 테이블이 모두 설정되어 있음
- **사용자 정의  VPC**
    - 사용자 정의 VPC는 서비스 목적에 따라 네트워크를 만들어서 사용하는 것입니다.
        - 클라우드 환경의 인프라를 어떻게 운영할지 얼마나 많은 서버를 배치할지에 따라 네트워크 범위는 다르게 설정
        - Default VPC와는 달리 자동으로 서브넷, 인터넷 게이트웨이, 라우팅 테이블이 만들어지지 않으므로 모든 네트워크 리소스를 만들어서 사용
        - 사용자 정의 VPC 예 : weplat-ap2-vpc
        - 10.0.0.0/16 (최대 65,536개의 프라이빗 IPv4 주소를 제공)
        - 퍼블릭 서브넷, 프라이빗 서브넷 , 인터넷 게이트웨이, 라우팅 테이블 별도 구성 필요